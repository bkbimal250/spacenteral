# SpaCentral Apache2 Configuration
# Place this file in: /etc/apache2/sites-available/spacentral.conf
# Enable with: sudo a2ensite spacentral.conf

<VirtualHost *:80>
    ServerName yourdomain.com
    ServerAlias www.yourdomain.com
    ServerAdmin info.dishaonlinesoution@gmail.com

    # Document Root for Frontend
    DocumentRoot /var/www/spacentral/frontend/dist

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/spacentral-error.log
    CustomLog ${APACHE_LOG_DIR}/spacentral-access.log combined

    # Static Files
    Alias /static /var/www/spacentral/staticfiles
    <Directory /var/www/spacentral/staticfiles>
        Require all granted
        Options -Indexes
        <IfModule mod_expires.c>
            ExpiresActive On
            ExpiresDefault "access plus 30 days"
        </IfModule>
    </Directory>

    # Media Files
    Alias /media /var/www/spacentral/media
    <Directory /var/www/spacentral/media>
        Require all granted
        Options -Indexes
        <IfModule mod_expires.c>
            ExpiresActive On
            ExpiresDefault "access plus 7 days"
        </IfModule>
    </Directory>

    # WSGI Configuration for Django Backend
    WSGIDaemonProcess spacentral python-home=/var/www/spacentral/venv python-path=/var/www/spacentral
    WSGIProcessGroup spacentral
    WSGIScriptAlias /api /var/www/spacentral/spa_central/wsgi.py process-group=spacentral
    WSGIScriptAlias /admin /var/www/spacentral/spa_central/wsgi.py process-group=spacentral

    <Directory /var/www/spacentral/spa_central>
        <Files wsgi.py>
            Require all granted
        </Files>
    </Directory>

    # WebSocket Proxy for Chat (using mod_proxy_wstunnel)
    ProxyPass /ws/ ws://localhost:8001/ws/
    ProxyPassReverse /ws/ ws://localhost:8001/ws/

    # Frontend React App
    <Directory /var/www/spacentral/frontend/dist>
        Require all granted
        Options -Indexes +FollowSymLinks
        AllowOverride All
        
        # React Router - redirect all requests to index.html
        RewriteEngine On
        RewriteBase /
        RewriteRule ^index\.html$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.html [L]
    </Directory>

    # Security Headers
    <IfModule mod_headers.c>
        Header always set X-Frame-Options "DENY"
        Header always set X-Content-Type-Options "nosniff"
        Header always set X-XSS-Protection "1; mode=block"
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
    </IfModule>

    # Compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>

</VirtualHost>

# HTTPS Configuration (uncomment after SSL setup)
# <VirtualHost *:443>
#     ServerName yourdomain.com
#     ServerAlias www.yourdomain.com
#     ServerAdmin info.dishaonlinesoution@gmail.com
#
#     DocumentRoot /var/www/spacentral/frontend/dist
#
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/yourdomain.com/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/yourdomain.com/privkey.pem
#     
#     # SSL Security
#     SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
#     SSLCipherSuite HIGH:!aNULL:!MD5
#     SSLHonorCipherOrder on
#
#     # ... rest of the configuration same as HTTP ...
# </VirtualHost>

